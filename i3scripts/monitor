#!/usr/bin/perl

use strict;
use warnings;
use utf8;

my $button = $ARGV[0] || $ENV{'block_button'} || 1;
my $args = '';

if($button == 1)
{
	my $output;
	my @outputs = (`xrandr` =~ /(\w+) connected/g);
	if(scalar @outputs == 1) {
		$output = $outputs[0];
	} else {
		$args = join "\n", @outputs;
		$output = `echo "$args" | rofi -dmenu`;
		$output =~ s/\s+$//;
	}
	
	if($output ne '')
	{
		my $others = '';
		foreach(@outputs) {
			if($_ ne $output) {
				$others .= "--output $_ --off ";
			}
		}
		if($output =~ m/LVDS/) {
			$args = "--dpi 96";
		}
		if($output =~ m/HDMI/) {
			$args = "--set 'Broadcast RGB' Full --set audio on --dpi 96";
		}
		`xrandr $others --output $output --auto --primary $args`;
		`xrandr -s 0`; # Reset virual screen size
		`notify-send "Using monitor: $output"`;
	}
}
