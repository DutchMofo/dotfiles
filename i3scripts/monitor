#!/usr/bin/perl

my $button = defined $ARGV[0] ?
	$ARGV[0] :
	(defined $ENV{'BLOCK_BUTTON'} ? $ENV{'BLOCK_BUTTON'} : 0);

my $output;
my $args;

if($button == 1) {
	my @outputs = (`xrandr` =~ /(\w+) connected/g);
	if(scalar @outputs == 1) {
		$output = @outputs[0];
	} else {
		$args = join "\n", @outputs;
		$output = `echo "$args" | rofi -dmenu`;
		$output =~ s/\s+$//;
	}
	
	if($output ne '') {
		`xrandr --output $output --auto`;
		`xrandr --output $output --primary`;
		if($output =~ m/HDMI/) {
			`xrandr --output $output --set 'Broadcast RGB' 'Full'`;
			`xrandr --output $output --set audio on`;
		}
		`notify-send "Using monitor: $output"`;
		foreach(@outputs) {
			if($_ ne $output) {
				`xrandr --output $_ --off`;
			}
		}
	}
}
