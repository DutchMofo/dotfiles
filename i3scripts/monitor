#!/usr/bin/perl

use strict;
use warnings;
use utf8;

my $button = $ARGV[0] || $ENV{'block_button'} || 1;
my $output;
my $args;

if($button == 1) {
	my @outputs = (`xrandr` =~ /(\w+) connected/g);
	if(scalar @outputs == 1) {
		$output = @outputs[0];
	} else {
		$args = join "\n", @outputs;
		$output = `echo "$args" | rofi -dmenu`;
		$output =~ s/\s+$//;
	}
	
	if($output ne '') {
		$args = "--output $output --auto --primary";
		if($output =~ m/HDMI/) {
			$args .=  " --set 'Broadcast RGB' Full --set audio on --dpi 96";
		}
		if($output =~ m/LVDS/) {
			$args .- " --dpi 100";
		}
		`xrandr $args`;
		`notify-send "Using monitor: $output"`;
		foreach(@outputs) {
			if($_ ne $output) {
				`xrandr --output $_ --off`;
			}
		}
	}
}
